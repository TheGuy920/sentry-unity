on:
  workflow_call:
    inputs:
      unity-version:
        required: true
        type: string
      api-level:
        required: true
        type: string

jobs:
  smoke-test:
    strategy:
      matrix:
        attempt: [1, 2, 3]
      max-parallel: 1
      fail-fast: false
    uses: ./.github/workflows/android-smoke-test.yml
    with:
      unity-version: ${{ inputs.unity-version }}
      api-level: ${{ inputs.api-level }}
      try: ${{ matrix.attempt }}
    if: ${{ always() && (matrix.attempt == 1 || failure()) }}

  final-status:
    needs: [smoke-test]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - run: |
          if [[ "${{ needs.smoke-test.result }}" == "success" ]]; then
            exit 0
          else
            exit 1
          fi
